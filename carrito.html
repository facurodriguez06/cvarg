<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tu Carrito | CV Arg</title>
  <link rel="icon" href="img/logo.png" type="image/png" />

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap"
    rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="stylesheet" href="css/carrito.css">
  <link rel="stylesheet" href="css/components.css">
  <link rel="stylesheet" href="css/title-effects.css">
  <link rel="stylesheet" href="css/auth-nav.css">
  <link rel="stylesheet" href="css/navbar.css">


</head>

<body>
  <nav id="navbar">
    <div class="logo">
      <img src="img/logo.png" alt="Logo" class="logo-img" />
    </div>
    <ul class="nav-links">
      <li><a href="index.html" onclick="closeMenu()">Inicio</a></li>
      <li><a href="index.html#analyzer" onclick="closeMenu()">Analizador</a></li>
      <li><a href="catalogo.html" onclick="closeMenu()">Catálogo</a></li>
      <li><a href="contacto.html" onclick="closeMenu()">Contacto</a></li>
    </ul>
    <div class="menu-toggle"><i class="fas fa-bars"></i></div>
    <a href="carrito.html" class="cart-icon-link">
      <div class="cart-icon">
        <i class="fas fa-shopping-cart"></i><span class="cart-count" id="cart-count">0</span>
      </div>
    </a>
    <a href="login.html" id="auth-link" onclick="closeMenu()"><i class="fas fa-sign-in-alt"></i> Ingresar</a>
  </nav>


  <header class="hero" id="home">
    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>
    <div class="hero-content" id="heroContent">
      <h1>Tu Carrito</h1>
      <p>
        Estás a un paso de potenciar tu futuro profesional.
      </p>
    </div>
  </header>


  <section class="cart-section">
    <div class="cart-items" id="cartItemsContainer"></div>
    <div class="empty-cart" id="emptyCartMessage">
      <i class="fas fa-shopping-basket" style="font-size: 5rem; color: #cbd5e1; margin-bottom: 20px"></i>
      <h2 style="font-size: 2rem; margin-bottom: 10px; color: var(--text-dark)">
        Tu carrito está vacío
      </h2>
      <p style="color: var(--text-light); margin-bottom: 30px">
        Parece que aún no has elegido tu plan de éxito.
      </p>
      <a href="catalogo.html" class="btn-shop">Ver Catálogo</a>
    </div>
    <aside class="cart-summary" id="cartSummary">
      <h2 class="summary-title">Resumen del Pedido</h2>
      <div class="coupon-box">
        <input type="text" id="couponInput" class="coupon-input" placeholder="Código promocional" />
        <button class="btn-apply" onclick="applyCoupon()">Aplicar</button>
      </div>
      <div class="summary-row">
        <span>Subtotal</span><span id="subtotalPrice">$0</span>
      </div>
      <div class="summary-row discount" id="discountRow">
        <span>Descuento <small id="discountName"></small></span><span id="discountAmount">-$0</span>
      </div>
      <div class="summary-row total">
        <span>Total</span><span id="totalPrice" style="color: var(--primary-blue)">$0</span>
      </div>
      <a href="#" id="checkout-btn" class="btn-checkout" onclick="proceedToCheckout(); return false;">Pagar con
        Mercado Pago <i class="fas fa-lock"></i></a>

      <!-- Botón de confirmación manual (aparece después de pagar) -->
      <button id="confirm-payment-btn" class="btn-checkout"
        style="display: none; background: var(--success); margin-top: 10px;"
        onclick="confirmPaymentManually(); return false;">
        <i class="fas fa-check-circle"></i> Ya pagué - Confirmar pago
      </button>

      <div style="
            text-align: center;
            margin-top: 15px;
            font-size: 0.8rem;
            color: var(--text-light);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
          ">
        <i class="fas fa-shield-alt" style="color: var(--success)"></i> Pago
        100% Seguro y Encriptado
      </div>
    </aside>
  </section>
  </div>

  <section id="postPaymentForm" class="wizard-section">
    <div class="wizard-card">
      <div class="wizard-header">
        <div class="progress-info">
          <span id="stepCounter">Paso 1 de 6</span>
          <span>Progreso</span>
        </div>
        <div class="progress-container">
          <div class="progress-bar" id="progressBar"></div>
        </div>
      </div>

      <form id="cvForm" class="wizard-body" onsubmit="return false;">
        <div class="step active" id="step1">
          <h2 class="step-title">Datos Personales</h2>
          <p class="step-desc">Información esencial para tu perfil. (<span style="color: var(--danger)">*</span>
            obligatorio)</p>
          <div class="form-grid">
            <div class="form-group"><label class="label">Nombres <span class="required">*</span></label><input
                type="text" name="nombres" class="input" required /></div>
            <div class="form-group"><label class="label">Apellidos <span class="required">*</span></label><input
                type="text" name="apellidos" class="input" required /></div>
            <div class="form-group"><label class="label">Edad</label><input type="number" name="edad" class="input" />
            </div>
            <div class="form-group"><label class="label">Fecha de Nacimiento <span
                  class="required">*</span></label><input type="date" name="fechaNacimiento" class="input" required />
            </div>
            <div class="form-group"><label class="label">Nacionalidad</label><input type="text" name="nacionalidad"
                class="input" /></div>
            <div class="form-group"><label class="label">Estado Civil</label><select class="select" name="estadoCivil">
                <option>Soltero/a</option>
                <option>Casado/a</option>
                <option>Divorciado/a</option>
                <option>Viudo/a</option>
              </select></div>
            <div class="form-group"><label class="label">Email <span class="required">*</span></label><input
                type="email" name="email" class="input" required /></div>
            <div class="form-group"><label class="label">Teléfono <span class="required">*</span></label><input
                type="tel" name="telefono" class="input" placeholder="+54 9..." required /></div>
            <div class="form-group"><label class="label">DNI <span class="required">*</span></label><input type="text"
                name="dni" class="input" required /></div>
            <div class="form-group"><label class="label">Provincia / Ciudad <span
                  class="required">*</span></label><input type="text" name="provincia" class="input"
                placeholder="Ej: Mendoza, Argentina" required /></div>
          </div>
          <div class="form-group" style="margin-top: 20px">
            <label class="label">¿Tenés LinkedIn?</label>
            <div class="toggle-group">
              <label class="toggle-label"><input type="radio" name="hasLinkedin" value="no" checked class="toggle-input"
                  onchange="toggleField('linkedinField', false)" /> No</label>
              <label class="toggle-label"><input type="radio" name="hasLinkedin" value="si" class="toggle-input"
                  onchange="toggleField('linkedinField', true)" /> Sí</label>
            </div>
            <div id="linkedinField" class="conditional-field"><label class="label">Link de tu perfil</label><input
                type="url" name="linkLinkedin" class="input" placeholder="https://linkedin.com/in/..." /></div>
          </div>
          <div class="form-group"><label class="label">¿Agregar CUIL?</label>
            <div class="toggle-group">
              <label class="toggle-label"><input type="radio" name="hasCuil" value="no" checked class="toggle-input"
                  onchange="toggleField('cuilField', false)" /> No</label>
              <label class="toggle-label"><input type="radio" name="hasCuil" value="si" class="toggle-input"
                  onchange="toggleField('cuilField', true)" /> Sí</label>
            </div>
            <div id="cuilField" class="conditional-field"><label class="label">Número de CUIL</label><input type="text"
                name="cuil" class="input" /></div>
          </div>
        </div>

        <div class="step" id="step2">
          <h2 class="step-title">Experiencia Laboral</h2>
          <p class="step-desc">Cuéntanos sobre tu trayectoria.</p>
          <div class="form-group"><label class="label">Disponibilidad</label><select class="select"
              name="disponibilidad">
              <option>Full Time</option>
              <option>Part Time</option>
              <option>Freelance</option>
            </select></div>
          <div class="form-group"><label class="label">Detalle de Experiencia <span class="required">*</span></label>
            <p style="font-size: 0.8rem; color: #666; margin-bottom: 5px">Formato: EMPRESA + PUESTO + FECHAS + TAREAS
            </p>
            <textarea name="experiencia" class="textarea guided" rows="8"
              placeholder="Ej: Carpintería Argentina - Mendoza - 2000 a 2005 - Cortar madera..." required></textarea>
          </div>
        </div>

        <div class="step" id="step3">
          <h2 class="step-title">Educación</h2>
          <div class="form-group"><label class="label">Detalle de Estudios <span class="required">*</span></label>
            <p style="font-size: 0.8rem; color: #666; margin-bottom: 5px">Formato: NIVEL + INSTITUCIÓN + TÍTULO + AÑO
            </p>
            <textarea name="educacion" class="textarea guided" rows="8"
              placeholder="Ej: Universitario - UTN - Ing. Sistemas - 2020" required></textarea>
          </div>
        </div>

        <div class="step" id="step4">
          <h2 class="step-title">Capacitación</h2>
          <div class="form-group"><label class="label">Cursos y Capacitaciones</label>
            <p style="font-size: 0.8rem; color: #666; margin-bottom: 5px">Formato: NOMBRE + ENTIDAD + AÑO + HORAS</p>
            <textarea name="cursos" class="textarea guided" rows="5"
              placeholder="Ej: Excel Avanzado - Coursera - 2023"></textarea>
          </div>
          <div class="form-group"><label class="label">Idiomas</label>
            <p style="font-size: 0.8rem; color: #666; margin-bottom: 5px">Formato: IDIOMA + NIVEL</p>
            <textarea name="idiomas" class="textarea guided" rows="4"
              placeholder="Ej: Inglés - Intermedio B2"></textarea>
          </div>
        </div>

        <div class="step" id="step5">
          <h2 class="step-title">Archivos</h2>
          <div class="form-group"><label class="label">¿Tenés CV viejo para basarnos?</label>
            <div class="toggle-group">
              <label class="toggle-label"><input type="radio" name="oldCv" value="no" checked class="toggle-input"
                  onchange="toggleField('uploadCv', false)" /> No</label>
              <label class="toggle-label"><input type="radio" name="oldCv" value="si" class="toggle-input"
                  onchange="toggleField('uploadCv', true)" /> Sí</label>
            </div>
            <div id="uploadCv" class="conditional-field">
              <div class="upload-box"><i class="fas fa-file-pdf" style="font-size: 2rem; color: #666"></i>
                <p>Adjuntar PDF/Word (Deshabilitado en demo)</p>
              </div>
            </div>
          </div>
          <div class="form-group" style="margin-top: 30px"><label class="label">Foto de Perfil</label>
            <div class="photo-preview" id="photoPreview"><i class="fas fa-user"></i><img id="previewImg" src=""
                alt="Preview" /></div>
            <div class="upload-box" onclick="document.getElementById('photoFile').click()"><input type="file"
                id="photoFile" hidden accept="image/*" onchange="previewPhoto(this)" /><i class="fas fa-camera"
                style="font-size: 2rem; color: var(--primary-blue)"></i>
              <p style="margin-top: 10px">Subir Foto</p>
            </div>
          </div>
        </div>

        <div class="step" id="step6">
          <h2 class="step-title">Información Adicional</h2>
          <p class="step-desc">Selecciona tus fuertes. (<span style="color: var(--danger)">*</span> al menos uno de cada
            grupo)</p>
          <div class="form-group"><label class="label">Habilidades Técnicas (Hard Skills) <span
                class="required">*</span></label>
            <div class="skills-container" id="hardSkillsContainer">
              <label class="skill-option"><input type="checkbox" name="hardSkills" value="Office / Excel" /><span
                  class="skill-badge">Office / Excel</span></label>
              <label class="skill-option"><input type="checkbox" name="hardSkills" value="Inglés" /><span
                  class="skill-badge">Inglés</span></label>
              <label class="skill-option"><input type="checkbox" name="hardSkills" value="Gestión de Proyectos" /><span
                  class="skill-badge">Gestión de Proyectos</span></label>
              <label class="skill-option"><input type="checkbox" name="hardSkills" value="Programación" /><span
                  class="skill-badge">Programación</span></label>
              <label class="skill-option"><input type="checkbox" name="hardSkills" value="Diseño Gráfico" /><span
                  class="skill-badge">Diseño Gráfico</span></label>
              <label class="skill-option"><input type="checkbox" name="hardSkills" value="Ventas" /><span
                  class="skill-badge">Ventas</span></label>
              <label class="skill-option"><input type="checkbox" name="hardSkills" value="Atención al Cliente" /><span
                  class="skill-badge">Atención al Cliente</span></label>
              <label class="skill-option"><input type="checkbox" name="hardSkills" value="Marketing Digital" /><span
                  class="skill-badge">Marketing Digital</span></label>
            </div>
            <input type="text" name="otherHardSkills" class="input" placeholder="Otras (separadas por comas)..."
              style="margin-top: 10px" />
          </div>
          <div class="form-group"><label class="label">Habilidades Blandas (Soft Skills) <span
                class="required">*</span></label>
            <div class="skills-container" id="softSkillsContainer">
              <label class="skill-option"><input type="checkbox" name="softSkills" value="Liderazgo" /><span
                  class="skill-badge">Liderazgo</span></label>
              <label class="skill-option"><input type="checkbox" name="softSkills" value="Trabajo en Equipo" /><span
                  class="skill-badge">Trabajo en Equipo</span></label>
              <label class="skill-option"><input type="checkbox" name="softSkills" value="Comunicación" /><span
                  class="skill-badge">Comunicación</span></label>
              <label class="skill-option"><input type="checkbox" name="softSkills" value="Proactividad" /><span
                  class="skill-badge">Proactividad</span></label>
              <label class="skill-option"><input type="checkbox" name="softSkills" value="Creatividad" /><span
                  class="skill-badge">Creatividad</span></label>
              <label class="skill-option"><input type="checkbox" name="softSkills" value="Adaptabilidad" /><span
                  class="skill-badge">Adaptabilidad</span></label>
              <label class="skill-option"><input type="checkbox" name="softSkills" value="Gestión del Tiempo" /><span
                  class="skill-badge">Gestión del Tiempo</span></label>
              <label class="skill-option"><input type="checkbox" name="softSkills"
                  value="Inteligencia Emocional" /><span class="skill-badge">Inteligencia Emocional</span></label>
            </div>
            <input type="text" name="otherSoftSkills" class="input" placeholder="Otras..." style="margin-top: 10px" />
          </div>
          <div class="form-group"><label class="label">Objetivo / Orientación <span
                class="required">*</span></label><input type="text" name="objetivo" class="input"
              placeholder="¿A qué puesto apuntas?" required /></div>
          <div class="form-group"><label class="label">Comentarios Finales</label><textarea name="comentarios"
              class="textarea" rows="3"></textarea></div>
        </div>

        <div class="success-view" id="successView">
          <div class="confetti-icon"><i class="fas fa-check-circle"></i></div>
          <h2 style="color: var(--text-dark); margin-bottom: 10px">¡Todo Listo!</h2>
          <p class="step-desc">Hemos recibido tu información. Comenzaremos a trabajar en tu perfil de inmediato.</p>
          <a href="index.html" class="btn btn-next"
            style="display: inline-flex; text-decoration: none; margin-top: 20px;">Volver al Inicio</a>
        </div>
      </form>

      <div class="wizard-footer" id="wizardFooter">
        <button class="btn btn-prev" id="btnPrev" onclick="changeStep(-1)" style="visibility: hidden"><i
            class="fas fa-arrow-left"></i> Atrás</button>
        <button class="btn btn-next" id="btnNext" onclick="changeStep(1)">Siguiente <i
            class="fas fa-arrow-right"></i></button>
      </div>
    </div>
  </section>

  <footer>
    <div style="margin-bottom: 20px">
      <img src="img/logo.png" alt="CV Arg Logo" class="footer-logo" />
    </div>
    <p style="opacity: 0.7; font-size: 0.9rem">
      Impulsando carreras desde 2025.
    </p>
    <div class="copyright">
      &copy; 2025 CvArg. Todos los derechos reservados.
    </div>
  </footer>

  <div class="custom-modal-overlay" id="modalOverlay">
    <div class="custom-modal">
      <i class="fas fa-info-circle modal-icon" id="modalIcon"></i>
      <h3 class="modal-title" id="modalTitle">Título</h3>
      <p class="modal-msg" id="modalMsg">Mensaje</p>
      <button class="modal-btn" onclick="closeModal()">Entendido</button>
    </div>
  </div>

  <!-- SCRIPT INLINE ANTIGUO COMENTADO - Ahora se usa js/carrito.js -->
  <!-- Este script usaba impulsopro_cart y tenía lógica conflictiva -->


  <!-- Fin del script de utilidades básicas. 
       El resto de la lógica del carrito está en js/carrito.js -->
  <!--
  NOTA: Se eliminó el código antiguo del carrito y wizard inline.
  Las funciones ahora están en:
  - js/carrito.js - Manejo del carrito y flujo de pago
  - formulario.html - Wizard de formulario (página separada)
  -->

  <!-- INICIO: Código del wizard COMENTADO - ya no se usa aquí, se redirige a formulario.html
  function changeStep(direction) {
  if (!input.value.trim()) {
  isValid = false;
  input.classList.add('error');
  input.addEventListener('input', function () { if (this.value.trim()) this.classList.remove('error'); });
  } else {
  input.classList.remove('error');
  }
  });

  // VALIDACIÓN ESPECÍFICA PASO 6 (CHECKBOXES)
  if (currentStep === 6) {
  const hardChecked = document.querySelectorAll('input[name="hardSkills"]:checked').length > 0;
  const softChecked = document.querySelectorAll('input[name="softSkills"]:checked').length > 0;
  const hardCont = document.getElementById('hardSkillsContainer');
  const softCont = document.getElementById('softSkillsContainer');

  if (!hardChecked) { isValid = false; hardCont.classList.add('error'); } else { hardCont.classList.remove('error'); }
  if (!softChecked) { isValid = false; softCont.classList.add('error'); } else { softCont.classList.remove('error'); }
  }

  if (!isValid) {
  showModal('Campos Incompletos', 'Por favor completa los campos obligatorios (*) marcados en rojo.', 'error');
  return;
  }
  }

  if (nextStep > 0 && nextStep <= totalSteps) {
    document.getElementById(`step${currentStep}`).classList.remove('active');
    document.getElementById(`step${nextStep}`).classList.add('active'); currentStep=nextStep; updateUI();
    document.getElementById('postPaymentForm').scrollIntoView({ behavior: 'smooth' }); } else if (nextStep> totalSteps)
    {
    submitForm();
    }
    }

    function updateUI() {
    const progress = ((currentStep) / totalSteps) * 100;
    document.getElementById('progressBar').style.width = `${progress}%`;
    document.getElementById('stepCounter').innerText = `Paso ${currentStep} de ${totalSteps}`;

    const btnPrev = document.getElementById('btnPrev');
    const btnNext = document.getElementById('btnNext');

    btnPrev.style.visibility = currentStep === 1 ? 'hidden' : 'visible';

    if (currentStep === totalSteps) {
    btnNext.innerHTML = 'Finalizar <i class="fas fa-check"></i>';
    btnNext.style.backgroundColor = 'var(--success)';
    } else {
    btnNext.innerHTML = 'Siguiente <i class="fas fa-arrow-right"></i>';
    btnNext.style.backgroundColor = 'var(--primary-blue)';
    }
    }

    function toggleField(fieldId, show) {
    document.getElementById(fieldId).style.display = show ? 'block' : 'none';
    }

    function previewPhoto(input) {
    if (input.files && input.files[0]) {
    const reader = new FileReader();
    reader.onload = function (e) {
    document.getElementById('previewImg').src = e.target.result;
    document.getElementById('previewImg').style.display = 'block';
    document.querySelector('.photo-preview i').style.display = 'none';
    }
    reader.readAsDataURL(input.files[0]);
    }
    }

    function submitForm() {
    const btn = document.getElementById('btnNext');
    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Procesando...';
    btn.disabled = true;
    btn.style.opacity = '0.7';

    // 1. Generate unique ID
    const uniqueId = Date.now().toString(36) + Math.random().toString(36).substr(2, 9);

    // 2. Gather form data
    const form = document.getElementById('cvForm');
    const formData = new FormData(form);
    const data = {};
    formData.forEach((value, key) => {
    if (data[key]) {
    if (!Array.isArray(data[key])) {
    data[key] = [data[key]];
    }
    data[key].push(value);
    } else {
    data[key] = value;
    }
    });

    // 3. Save to localStorage or Send to Backend
    // Como es front-only por ahora, simulamos éxito y guardamos local
    try {
    localStorage.setItem('formData-' + uniqueId, JSON.stringify(data));
    // Opcional: Aquí se podría llamar al Script de Google si quisieras guardar todo
    } catch (e) {
    console.error("Error saving to localStorage", e);
    }

    setTimeout(() => {
    // 4. Show success view INSIDE the wizard
    document.getElementById('cvForm').innerHTML = document.getElementById('successView').outerHTML;
    document.getElementById('successView').style.display = 'block'; // Ensure it's visible
    document.getElementById('wizardFooter').style.display = 'none';
    document.getElementById('progressBar').style.width = '100%';
    }, 1500);
    }

    function renderCart() {
    const cart = JSON.parse(localStorage.getItem("impulsopro_cart")) || [];
    const container = document.getElementById("cartItemsContainer");
    const summary = document.getElementById("cartSummary");
    const emptyMsg = document.getElementById("emptyCartMessage");
    const badge = document.getElementById("cart-count");

    let totalQty = cart.reduce((acc, item) => acc + item.quantity, 0);
    if (badge) {
    badge.innerText = totalQty;
    badge.style.display = totalQty === 0 ? "none" : "flex";
    }

    if (cart.length === 0) {
    container.style.display = "none";
    summary.style.display = "none";
    emptyMsg.style.display = "block";
    return;
    } else {
    container.style.display = "flex";
    summary.style.display = "block";
    emptyMsg.style.display = "none";
    }

    container.innerHTML = "";
    let subtotal = 0;

    cart.forEach((item, index) => {
    const itemTotal = item.price * item.quantity;
    subtotal += itemTotal;
    let iconClass = "fas fa-star";
    const nameLower = item.name.toLowerCase();
    if (nameLower.includes("cv")) iconClass = "fas fa-file-contract";
    else if (nameLower.includes("linkedin"))
    iconClass = "fab fa-linkedin";
    else if (
    nameLower.includes("web") ||
    nameLower.includes("portafolio")
    )
    iconClass = "fas fa-laptop-code";
    else if (nameLower.includes("traduccion"))
    iconClass = "fas fa-language";

    container.innerHTML += `
    <div class="cart-item">
      <div class="item-icon"><i class="${iconClass}"></i></div>
      <div class="item-info">
        <h3>${item.name}</h3>
        <p>Servicio Profesional Digital</p>
      </div>
      <div class="item-price">$${itemTotal}</div>
      <button class="btn-remove" onclick="removeItem(${index})"><i class="fas fa-trash-alt"></i></button>
    </div>`;
    });
    updateTotals(subtotal);
    }

    function updateTotals(subtotal) {
    const discountAmount = subtotal * currentDiscount;
    const total = subtotal - discountAmount;
    document.getElementById("subtotalPrice").innerText = `$${subtotal}`;
    document.getElementById("totalPrice").innerText = `$${total.toFixed(
    0
    )}`;
    const discountRow = document.getElementById("discountRow");
    if (currentDiscount > 0) {
    discountRow.style.display = "flex";
    document.getElementById(
    "discountAmount"
    ).innerText = `-$${discountAmount.toFixed(0)}`;
    } else {
    discountRow.style.display = "none";
    }
    }

    function removeItem(index) {
    let cart = JSON.parse(localStorage.getItem("impulsopro_cart")) || [];
    cart.splice(index, 1);
    localStorage.setItem("impulsopro_cart", JSON.stringify(cart));
    renderCart();
    }



    // --- CONEXIÓN MP MEJORADA ---
    async function proceedToCheckout() {
    const btn = document.querySelector(".btn-checkout");
    const originalText = btn.innerHTML;
    const cart = JSON.parse(localStorage.getItem("impulsopro_cart")) || [];

    if (cart.length === 0) return;

    btn.innerHTML =
    '<i class="fas fa-spinner fa-spin"></i> Generando Link...';
    btn.style.opacity = "0.7";
    btn.style.pointerEvents = "none";

    const items = cart.map((item) => ({
    title: item.name,
    quantity: item.quantity,
    currency_id: "ARS",
    unit_price: item.price,
    }));

    const payload = { action: "create_preference", items: items };

    try {
    // FETCH CON TEXT/PLAIN PARA EVITAR CORS
    const response = await fetch(SCRIPT_URL, {
    method: "POST",
    body: JSON.stringify(payload),
    headers: { "Content-Type": "text/plain;charset=utf-8" },
    });

    if (!response.ok) throw new Error(`Error HTTP: ${response.status}`);

    const data = await response.json();

    if (data.init_point) {
    window.open(data.init_point, '_blank');
    } else if (data.status === "error") {
    throw new Error(data.message || "Error interno del script");
    } else if (data.error) {
    throw new Error(data.error);
    } else {
    throw new Error("Respuesta inesperada del servidor");
    }
    } catch (error) {
    console.error(error);
    let msg = "No pudimos conectar con Mercado Pago. ";
    if (error.message.includes("Failed to fetch"))
    msg +=
    "Verifica la URL del script. ¿Hiciste un NUEVO despliegue con acceso 'Cualquiera'?";
    else msg += error.message;

    showModal("Error de Conexión", msg, "error");
    btn.innerHTML = originalText;
    btn.style.opacity = "1";
    btn.style.pointerEvents = "auto";
    }
    }
    FIN: Código del wizard COMENTADO -->
  <script src="js/api.js"></script>
  <script src="js/carrito.js"></script>
  <script src="js/components.js"></script>
  <script src="js/auth-nav.js"></script>
</body>

</html>