<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finalizar Compra | ImpulsoPro</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary-blue: #044bab; --primary-dark: #022a61; --primary-light: #e6effa;
            --accent-yellow: #f3d136; --text-dark: #1f2937; --text-gray: #6b7280;
            --white: #ffffff; --bg-light: #f9fafb; --border-color: #e5e7eb; --success: #10b981;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { background-color: var(--bg-light); color: var(--text-dark); }

        /* NOTIFICACIONES */
        .notification-container { position: fixed; bottom: 20px; right: 20px; z-index: 2000; }
        .toast {
            background: var(--primary-dark); color: var(--white); padding: 1rem 2rem; border-radius: 50px;
            margin-top: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); display: flex; align-items: center; gap: 10px;
            transform: translateX(120%); transition: transform 0.3s ease; font-weight: 500;
        }
        .toast.show { transform: translateX(0); }

        nav { padding: 1.5rem 5%; background: var(--white); border-bottom: 1px solid var(--border-color); display: flex; justify-content: center; align-items: center; }
        .logo { font-size: 1.5rem; font-weight: 800; color: var(--primary-blue); display: flex; align-items: center; gap: 10px; text-decoration: none; }

        .stepper-container { max-width: 600px; margin: 3rem auto 4rem; position: relative; padding: 0 20px; }
        .progress-bar-bg { position: absolute; top: 20px; left: 50px; right: 50px; height: 4px; background: #e5e7eb; z-index: 1; }
        .progress-bar-fill { position: absolute; top: 20px; left: 50px; height: 4px; background: var(--primary-blue); width: 50%; z-index: 1; }
        .steps { display: flex; justify-content: space-between; position: relative; z-index: 2; }
        .step { display: flex; flex-direction: column; align-items: center; gap: 8px; background: var(--bg-light); padding: 0 10px; }
        .step-icon { width: 45px; height: 45px; border-radius: 50%; background: var(--white); border: 2px solid var(--border-color); display: flex; justify-content: center; align-items: center; color: var(--text-gray); font-size: 1.1rem; }
        .step.active .step-icon { background: var(--primary-blue); border-color: var(--primary-blue); color: var(--white); }

        .checkout-layout { max-width: 1200px; margin: 0 auto; padding: 0 20px 5rem; display: grid; grid-template-columns: 2fr 1fr; gap: 2.5rem; align-items: start; }
        .section-box { background: var(--white); border-radius: 12px; padding: 2rem; box-shadow: 0 2px 10px rgba(0,0,0,0.03); margin-bottom: 2rem; }
        .section-title { font-size: 1.25rem; color: var(--text-dark); margin-bottom: 1.5rem; font-weight: 700; }

        .product-row { display: flex; justify-content: space-between; align-items: center; padding: 1.5rem 0; border-bottom: 1px solid var(--border-color); }
        .product-info { display: flex; align-items: center; gap: 15px; flex-grow: 1; }
        .product-icon { width: 50px; height: 50px; background: var(--primary-light); color: var(--primary-blue); border-radius: 8px; display: flex; justify-content: center; align-items: center; flex-shrink: 0; }
        .product-controls { display: flex; align-items: center; gap: 10px; margin-right: 20px; }
        .btn-qty { width: 30px; height: 30px; border-radius: 50%; border: 1px solid var(--border-color); background: white; cursor: pointer; display: flex; justify-content: center; align-items: center; transition: all 0.2s; }
        .btn-qty:hover { background: var(--primary-light); color: var(--primary-blue); border-color: var(--primary-blue); }
        .btn-remove { color: #ef4444; border: none; background: transparent; cursor: pointer; margin-left: 10px; font-size: 0.9rem; }
        
        .form-control { width: 100%; padding: 0.9rem 1rem; border: 1px solid var(--border-color); border-radius: 8px; background: #fafafa; margin-bottom: 1rem; }
        .summary-card { background: var(--white); border-radius: 12px; padding: 2rem; box-shadow: 0 5px 20px rgba(0,0,0,0.05); position: sticky; top: 20px; }
        .summary-total { display: flex; justify-content: space-between; margin-top: 1.5rem; padding-top: 1rem; border-top: 2px solid var(--border-color); font-size: 1.25rem; font-weight: 800; }
        .btn-pay { width: 100%; margin-top: 2rem; padding: 1rem; background-color: var(--primary-blue); color: var(--white); border: none; border-radius: 8px; font-size: 1.1rem; font-weight: 600; cursor: pointer; display: flex; justify-content: center; align-items: center; gap: 10px; }
        
        .empty-cart-msg { text-align: center; padding: 2rem; color: var(--text-gray); }
        
        @media (max-width: 900px) { .checkout-layout { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

    <div class="notification-container" id="notificationContainer"></div>

    <nav>
        <a href="index.html" class="logo"><i class="fas fa-rocket"></i> ImpulsoPro</a>
    </nav>

    <div class="stepper-container">
        <div class="progress-bar-bg"></div><div class="progress-bar-fill"></div>
        <div class="steps">
            <div class="step active"><div class="step-icon"><i class="fas fa-shopping-cart"></i></div><span>Carrito</span></div>
            <div class="step"><div class="step-icon"><i class="fas fa-credit-card"></i></div><span>Pago</span></div>
        </div>
    </div>

    <main class="checkout-layout">
        <div class="checkout-details">
            <section class="section-box">
                <h2 class="section-title">Resumen de productos</h2>
                <div id="cartItemsContainer"></div>
            </section>

            <section class="section-box">
                <h2 class="section-title">Datos del Cliente</h2>
                <input type="text" class="form-control" placeholder="Nombre Completo">
                <input type="email" class="form-control" placeholder="Correo Electrónico">
            </section>
        </div>

        <aside class="summary-card">
            <h3>Total a Pagar</h3>
            <div class="summary-total"><span>Total:</span><span id="totalPrice">0.00€</span></div>
            <button class="btn-pay" onclick="processPayment()">Pagar Ahora <i class="fas fa-lock"></i></button>
        </aside>
    </main>

    <script>
        function getCart() { return JSON.parse(localStorage.getItem('impulsopro_cart')) || []; }
        function saveCart(cart) { localStorage.setItem('impulsopro_cart', JSON.stringify(cart)); renderCart(); }

        function renderCart() {
            const cart = getCart();
            const container = document.getElementById('cartItemsContainer');
            const totalEl = document.getElementById('totalPrice');
            container.innerHTML = '';
            
            let total = 0;

            if (cart.length === 0) {
                container.innerHTML = '<div class="empty-cart-msg">Tu carrito está vacío <br><a href="catalogo.html" style="color:var(--primary-blue)">Ir al catálogo</a></div>';
                totalEl.innerText = "0.00€";
                return;
            }

            cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                
                const div = document.createElement('div');
                div.className = 'product-row';
                div.innerHTML = `
                    <div class="product-info">
                        <div class="product-icon"><i class="${item.icon || 'fas fa-box'}"></i></div>
                        <div><strong>${item.name}</strong><br><small>${item.price}€ / unidad</small></div>
                    </div>
                    <div class="product-controls">
                        <button class="btn-qty" onclick="changeQty('${item.id}', -1)"><i class="fas fa-minus" style="font-size:0.7rem"></i></button>
                        <span style="font-weight:600; min-width:20px; text-align:center">${item.quantity}</span>
                        <button class="btn-qty" onclick="changeQty('${item.id}', 1)"><i class="fas fa-plus" style="font-size:0.7rem"></i></button>
                    </div>
                    <div style="font-weight:700; min-width:60px; text-align:right;">${itemTotal}€</div>
                    <button class="btn-remove" onclick="removeItem('${item.id}')"><i class="fas fa-trash"></i></button>
                `;
                container.appendChild(div);
            });

            totalEl.innerText = total + ".00€";
        }

        function changeQty(id, change) {
            let cart = getCart();
            const item = cart.find(i => i.id === id);
            if (item) {
                item.quantity += change;
                if (item.quantity < 1) item.quantity = 1;
                saveCart(cart);
            }
        }

        function removeItem(id) {
            let cart = getCart();
            cart = cart.filter(i => i.id !== id);
            saveCart(cart);
            showNotification('Producto eliminado');
        }

        function showNotification(message) {
            const container = document.getElementById('notificationContainer');
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.innerHTML = `<i class="fas fa-info-circle"></i> ${message}`;
            container.appendChild(toast);
            setTimeout(() => toast.classList.add('show'), 100);
            setTimeout(() => { toast.classList.remove('show'); setTimeout(() => toast.remove(), 300); }, 3000);
        }

        function processPayment() {
            if(getCart().length === 0) {
                showNotification("El carrito está vacío");
                return;
            }
            showNotification("Procesando pago...");
            setTimeout(() => {
                localStorage.removeItem('impulsopro_cart');
                renderCart();
                showNotification("¡Pago realizado con éxito!");
            }, 2000);
        }

        window.addEventListener('load', renderCart);
    </script>
</body>
</html>