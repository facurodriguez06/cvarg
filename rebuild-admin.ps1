$content = @'
// ADMIN.JS - Panel de Administración Completo
// Reconstruido el 2025-12-24

const API_BASE_URL = "http://localhost:3000/api";
const api = {baseURL:API_BASE_URL,getToken(){return localStorage.getItem("token")},async request(e,t={}){const o=this.getToken(),n={"Content-Type":"application/json",...t.headers};o&&(n.Authorization=`Bearer ${o}`);const r=await fetch(`${this.baseURL}${e}`,{...t,headers:n});if(!r.ok){const e=await r.json();throw new Error(e.error||"Error en la petición")}return r.json()},async getProducts(){return this.request("/products")},async createProduct(e){return this.request("/products",{method:"POST",body:JSON.stringify(e)})},async updateProduct(e,t){return this.request(`/products/${e}`,{method:"PUT",body:JSON.stringify(t)})},async deleteProduct(e){return this.request(`/products/${e}`,{method:"DELETE"})},async getUsers(){return this.request("/admin/users")},async createUser(e){return this.request("/admin/users",{method:"POST",body:JSON.stringify(e)})},async updateUser(e,t){return this.request(`/admin/users/${e}`,{method:"PUT",body:JSON.stringify(t)})},async deleteUser(e){return this.request(`/admin/users/${e}`,{method:"DELETE"})},async getOrders(){return this.request("/admin/orders")},async updateOrderStatus(e,t){return this.request(`/admin/orders/${e}/status`,{method:"PUT",body:JSON.stringify({deliveryStatus:t})})},async getCVSubmissions(){return this.request("/admin/cv-submissions")},async getCVSubmission(e){return this.request(`/admin/cv-submissions/${e}`)},async updateCVStatus(e,t){return this.request(`/admin/cv-submissions/${e}/status`,{method:"PUT",body:JSON.stringify({deliveryStatus:t})})},async generateAIContent(e,t="all"){return this.request(`/admin/cv-submissions/${e}/generate-ai`,{method:"POST",body:JSON.stringify({section:t})})}};function showToast(e,t="info"){const o=document.createElement("div");o.className=`toast ${t}`,o.textContent=e,document.body.appendChild(o),setTimeout(()=>o.classList.add("show"),100),setTimeout(()=>{o.classList.remove("show"),setTimeout(()=>o.remove(),300)},3e3)}async function checkAdminAccess(){const e=localStorage.getItem("token");if(!e)return window.location.href="/login.html?redirect=admin",!1;try{const e=await api.request("/auth/me");return e.user&&"admin"===e.user.role||(showToast("Acceso denegado. Se requiere rol de administrador.","error"),setTimeout(()=>{window.location.href="/index.html"},2e3),!1)}catch(e){return console.error("Error verificando acceso:",e),localStorage.removeItem("token"),window.location.href="/login.html?redirect=admin",!1}}let currentSection="dashboard",currentCVSubmission=null,pollIntervals={};async function init(){if(!await checkAdminAccess())return;const e=document.getElementById("loading-screen");e&&(e.style.display="none");const t=document.querySelector(".admin-content");t&&(t.style.display="block"),setupNavigation(),setupNavbarScroll(),showSection("dashboard")}document.addEventListener("DOMContentLoaded",init);function setupNavigation(){document.querySelectorAll("[data-section]").forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();const o=e.getAttribute("data-section");showSection(o)})})}function showSection(e){document.querySelectorAll(".admin-section").forEach(e=>{e.classList.remove("active")});const t=document.getElementById(`section-${e}`);t&&t.classList.add("active"),document.querySelectorAll("[data-section]").forEach(e=>{e.classList.remove("active")});const o=document.querySelector(`[data-section="${e}"]`);o&&o.classList.add("active"),currentSection=e,loadSectionData(e)}async function loadSectionData(e){switch(e){case"dashboard":await loadDashboard();break;case"products":await loadProducts();break;case"users":await loadUsers();break;case"orders":await loadOrders();break;case"cvforms":await loadCVForms()}}function setupNavbarScroll(){const e=document.querySelector(".admin-navbar");e&&window.addEventListener("scroll",()=>{window.scrollY>50?e.classList.add("scrolled"):e.classList.remove("scrolled")})}async function loadDashboard(){try{const[e,t,o,n]=await Promise.all([api.getProducts(),api.getUsers(),api.getOrders(),api.getCVSubmissions()]);document.getElementById("stat-products").textContent=e.length||0,document.getElementById("stat-users").textContent=t.length||0,document.getElementById("stat-orders").textContent=o.length||0,document.getElementById("stat-cvforms").textContent=n.length||0}catch(e){console.error("Error cargando dashboard:",e),showToast("Error cargando estadísticas","error")}}async function loadProducts(){try{const e=await api.getProducts();displayProducts(e)}catch(e){console.error("Error cargando productos:",e),showToast("Error cargando productos","error")}}function displayProducts(e){const t=document.querySelector("#products-table tbody");t&&(t.innerHTML=e.map(e=>`<tr><td>${e.id}</td><td>${e.name}</td><td>$${e.price}</td><td><span class="status-badge ${e.isActive?"active":"inactive"}">${e.isActive?"Activo":"Inactivo"}</span></td><td><div class="action-buttons"><button class="action-btn edit" onclick="editProduct(${e.id})"><i class="fas fa-edit"></i></button><button class="action-btn delete" onclick="deleteProduct(${e.id})"><i class="fas fa-trash"></i></button></div></td></tr>`).join(""))}async function loadUsers(){try{const e=await api.getUsers();displayUsers(e)}catch(e){console.error("Error cargando usuarios:",e),showToast("Error cargando usuarios","error")}}function displayUsers(e){const t=document.querySelector("#users-table tbody");t&&(t.innerHTML=e.map(e=>`<tr><td>${e.id}</td><td>${e.email}</td><td><span class="role-badge ${e.role}">${"admin"===e.role?"Admin":"Usuario"}</span></td><td><span class="status-badge ${e.isActive?"active":"inactive"}">${e.isActive?"Activo":"Inactivo"}</span></td><td>${new Date(e.createdAt).toLocaleDateString()}</td><td><div class="action-buttons"><button class="action-btn edit" onclick="editUser(${e.id})"><i class="fas fa-edit"></i></button><button class="action-btn delete" onclick="deleteUser(${e.id})"><i class="fas fa-trash"></i></button></div></td></tr>`).join(""))}async function loadOrders(){try{const e=await api.getOrders();displayOrders(e)}catch(e){console.error("Error cargando pedidos:",e),showToast("Error cargando pedidos","error")}}function displayOrders(e){const t=document.querySelector("#orders-table tbody");t&&(t.innerHTML=e.map(e=>`<tr><td>#${e.id}</td><td>${e.user?.email||"N/A"}</td><td>$${e.total}</td><td><span class="status-badge ${e.paymentStatus}">${"paid"===e.paymentStatus?"Pagado":"Pendiente"}</span></td><td><span class="status-badge ${e.deliveryStatus}">${getDeliveryStatusText(e.deliveryStatus)}</span></td><td>${new Date(e.createdAt).toLocaleDateString()}</td><td><div class="action-buttons"><button class="action-btn review" onclick="viewOrder(${e.id})"><i class="fas fa-eye"></i> Ver</button></div></td></tr>`).join(""))}function getDeliveryStatusText(e){return{pending:"Pendiente","in-progress":"En Progreso",completed:"Completado",cancelled:"Cancelado"}[e]||e}

// CV FORMS - LA PARTE PRINCIPAL
async function loadCVForms(){try{const e=await api.getCVSubmissions();displayCVForms(e)}catch(e){console.error("Error:",e),showToast("Error cargando formularios","error")}}function displayCVForms(e){const t=document.querySelector("#cvforms-table tbody");t&&(t.innerHTML=e.map(e=>`<tr><td>#${e.id}</td><td>${e.fullName}</td><td>${e.email}</td><td>${e.phone||"-"}</td><td><span class="status-badge ${e.deliveryStatus}">${getDeliveryStatusText(e.deliveryStatus)}</span></td><td>${new Date(e.createdAt).toLocaleDateString()}</td><td><div class="action-buttons"><button class="action-btn view" onclick="viewCVSubmission(${e.id})"><i class="fas fa-eye"></i></button></div></td></tr>`).join(""))}async function viewCVSubmission(e){try{const t=await api.getCVSubmission(e);currentCVSubmission=t;const o=buildCVDetailHTML(t),n=document.getElementById("cv-modal-body");n&&(n.innerHTML=o),openModal("cv-modal")}catch(e){console.error("Error:",e),showToast("Error cargando detalle","error")}}

// CONSTRUCCIÓN DEL DETALLE CV - CON TODOS LOS CAMPOS
function buildCVDetailHTML(f){const edu=f.education||[],exp=f.experience||[],hard=f.hardSkills||[],soft=f.softSkills||[],lang=f.languages||[];return`<div class="cv-section"><div class="cv-section-header"><h4><i class="fas fa-user"></i> Datos Personales</h4><button class="btn-copy" onclick="copySectionToClipboard('personal')"><i class="fas fa-copy"></i> Copiar</button></div><div class="cv-section-content" id="section-personal"><div class="cv-grid"><div class="cv-field"><label>Nombre Completo</label><span>${f.fullName||"-"}</span></div><div class="cv-field"><label>Email</label><span>${f.email||"-"}</span></div><div class="cv-field"><label>Teléfono</label><span>${f.phone||"-"}</span></div><div class="cv-field"><label>DNI</label><span>${f.dni||"-"}</span></div><div class="cv-field"><label>Fecha de Nacimiento</label><span>${f.birthDate?new Date(f.birthDate).toLocaleDateString("es-AR"):"-"}</span></div><div class="cv-field"><label>Edad</label><span>${f.age||"-"}</span></div><div class="cv-field"><label>Nacionalidad</label><span>${f.nationality||"-"}</span></div><div class="cv-field"><label>Ciudad</label><span>${f.city||f.address||"-"}</span></div><div class="cv-field"><label>LinkedIn</label><span>${f.linkedin?`<a href="${f.linkedin}" target="_blank">${f.linkedin}</a>`:"-"}</span></div><div class="cv-field"><label>Objetivo</label><span>${f.objective||"-"}</span></div></div></div></div><div class="cv-section"><div class="cv-section-header"><h4><i class="fas fa-briefcase"></i> Experiencia</h4><div class="section-actions"><button class="btn-copy" onclick="copySectionToClipboard('experience')"><i class="fas fa-copy"></i></button><button class="btn-ai-mini" onclick="generateAISection('experiencia')"><i class="fas fa-magic"></i> IA</button></div></div><div class="cv-section-content" id="section-experience">${formatExperience(exp)}</div><div class="ai-output" id="ai-output-experiencia" style="display:none;"><div class="ai-output-header"><span><i class="fas fa-robot"></i> IA</span><button class="btn-copy-small" onclick="copyAIOutput('experiencia')"><i class="fas fa-copy"></i></button></div><div class="ai-output-content" id="ai-content-experiencia"></div></div></div><div class="cv-section"><div class="cv-section-header"><h4><i class="fas fa-graduation-cap"></i> Educación</h4><div class="section-actions"><button class="btn-copy" onclick="copySectionToClipboard('education')"><i class="fas fa-copy"></i></button><button class="btn-ai-mini" onclick="generateAISection('educacion')"><i class="fas fa-magic"></i> IA</button></div></div><div class="cv-section-content" id="section-education">${formatEducation(edu)}</div><div class="ai-output" id="ai-output-educacion" style="display:none;"><div class="ai-output-header"><span><i class="fas fa-robot"></i> IA</span><button class="btn-copy-small" onclick="copyAIOutput('educacion')"><i class="fas fa-copy"></i></button></div><div class="ai-output-content" id="ai-content-educacion"></div></div></div><div class="cv-section"><div class="cv-section-header"><h4><i class="fas fa-tools"></i> Habilidades</h4><button class="btn-copy" onclick="copySectionToClipboard('skills')"><i class="fas fa-copy"></i></button></div><div class="cv-section-content" id="section-skills"><div class="skills-display"><div class="skills-group"><label>Hard Skills</label><div class="skills-tags">${hard.length>0?hard.map(s=>`<span class="skill-tag hard">${s}</span>`).join(""):'<span style="color:#a0aec0;font-style:italic;">Sin habilidades registradas</span>'}</div></div><div class="skills-group"><label>Soft Skills</label><div class="skills-tags">${soft.length>0?soft.map(s=>`<span class="skill-tag soft">${s}</span>`).join(""):'<span style="color:#a0aec0;font-style:italic;">Sin habilidades registradas</span>'}</div></div></div></div></div><div class="cv-section"><div class="cv-section-header"><h4><i class="fas fa-language"></i> Idiomas</h4><button class="btn-copy" onclick="copySectionToClipboard('languages')"><i class="fas fa-copy"></i></button></div><div class="cv-section-content" id="section-languages">${formatLanguages(lang)}</div></div><div class="cv-section ai-full-section"><div class="cv-section-header"><h4><i class="fas fa-file-alt"></i> CV Completo con IA</h4><button class="btn-ai" onclick="generateFullAI()"><i class="fas fa-magic"></i> Generar CV con IA</button></div><div class="ai-output" id="ai-output-full" style="display:none;"><div class="ai-output-content" id="ai-content-full"></div></div><p class="ai-hint" id="ai-hint">Presiona "Generar CV con IA"</p><button class="btn-copy" onclick="copyAIOutput('full')" id="copy-full-btn" style="display:none;"><i class="fas fa-copy"></i> Copiar</button></div>`}

// FORMATEO DE SECCIONES
function formatExperience(e){return e&&Array.isArray(e)&&e.length>0?"string"==typeof e?`<pre class="raw-data">${e}</pre>`:e.map(e=>`<div class="experience-item"><strong>${e.puesto||e.position||"Puesto"}</strong> en <strong>${e.empresa||e.company||"Empresa"}</strong><div class="exp-period">${e.periodo||e.period||""}</div><p>${e.tareas||e.tasks||""}</p></div>`).join(""):'<p class="no-data">Sin experiencia</p>'}function formatEducation(e){return e&&Array.isArray(e)&&e.length>0?"string"==typeof e?`<pre class="raw-data">${e}</pre>`:e.map(e=>`<div class="education-item"><strong>${e.titulo||e.title||"Título"}</strong><div class="edu-institution">${e.institucion||e.institution||""}</div><div class="edu-year">${e.año||e.year||""}</div></div>`).join(""):'<p class="no-data">Sin educación</p>'}function formatLanguages(e){return e&&Array.isArray(e)&&e.length>0?e.map(e=>`<div class="language-item"><strong>${e.idioma||e.language||"Idioma"}</strong><span class="lang-level">${e.nivel||e.level||""}</span></div>`).join(""):"object"==typeof e&&Object.keys(e).length>0?`<pre class="raw-data">${JSON.stringify(e,null,2)}</pre>`:'<p class="no-data">Sin idiomas</p>'}

// IA Y POLLING
async function generateAISection(e){if(!currentCVSubmission)return;const t=document.getElementById(`ai-output-${e}`),o=document.getElementById(`ai-content-${e}`);t.style.display="block",o.innerHTML='<div class="ai-loading"><i class="fas fa-spinner fa-spin"></i> Encolando...</div>';try{const t=await api.generateAIContent(currentCVSubmission.id,e);t&&t.jobId?(o.innerHTML='<div class="ai-loading"><i class="fas fa-clock"></i> En cola...</div>',pollJobStatus(t.jobId,e)):(o.innerHTML='<p class="ai-error">Error al encolar</p>',showToast("Error","error"))}catch(e){console.error("Error:",e),o.innerHTML=`<p class="ai-error">Error: ${e.message}</p>`,showToast("Error","error")}}async function pollJobStatus(e,t){const o=document.getElementById(`ai-content-${t}`),n=`${t}_${e}`;pollIntervals[n]&&clearInterval(pollIntervals[n]);const r=async()=>{try{const r=await fetch(`${api.baseURL}/admin/ai-queue/status/${e}`,{headers:{Authorization:`Bearer ${api.getToken()}`}});if(!r.ok)throw new Error("Error al obtener estado");const a=await r.json();if(a.success&&a.job){const{status:e,result:r,error:i}=a.job,{position:s,pendingCount:c,estimatedWaitMinutes:l}=a.queue;"pending"===e?o.innerHTML=`<div class="ai-queue-status"><i class="fas fa-hourglass-half"></i><p><strong>En cola - Posición #${s||"?"}</strong></p><p class="queue-details">${c} solicitudes pendientes</p><p class="queue-time">⏱️ Tiempo estimado: ~${l} min</p></div>`:"processing"===e?o.innerHTML='<div class="ai-loading"><i class="fas fa-cog fa-spin"></i> Procesando...</div>':"completed"===e?(o.innerHTML=`<pre>${r}</pre>`,showToast("Contenido generado","success"),"full"===t&&(document.getElementById("copy-full-btn").style.display="inline-flex"),clearInterval(pollIntervals[n]),delete pollIntervals[n]):"failed"===e&&(o.innerHTML=`<p class="ai-error">Error: ${i||"Desconocido"}</p>`,showToast("Error generando","error"),clearInterval(pollIntervals[n]),delete pollIntervals[n])}}catch(e){console.error("Error polling:",e)}};r(),pollIntervals[n]=setInterval(r,5e3)}async function generateFullAI(){if(!currentCVSubmission)return;const e=document.getElementById("ai-output-full"),t=document.getElementById("ai-content-full"),o=document.getElementById("ai-hint");e.style.display="block",o.style.display="none",t.innerHTML='<div class="ai-loading"><i class="fas fa-spinner fa-spin"></i> Encolando...</div>';try{const e=await api.generateAIContent(currentCVSubmission.id,"all");e&&e.jobId?(t.innerHTML='<div class="ai-loading"><i class="fas fa-clock"></i> En cola...</div>',pollJobStatus(e.jobId,"full")):(t.innerHTML='<p class="ai-error">Error</p>',showToast("Error","error"))}catch(e){console.error("Error:",e),t.innerHTML=`<p class="ai-error">Error: ${e.message}</p>`,showToast("Error","error")}}

// UTILIDADES
function copySectionToClipboard(e){const t=document.getElementById(`section-${e}`)?.innerText;t?(navigator.clipboard.writeText(t),showToast("Copiado!","success")):showToast("Error copiando","error")}function copyAIOutput(e){const t=document.getElementById(`ai-content-${e}`)?.innerText;t?(navigator.clipboard.writeText(t),showToast("Copiado!","success")):showToast("Error","error")}function openModal(e){document.getElementById(e)?.classList.add("active")}function closeModal(e){document.getElementById(e)?.classList.remove("active")}document.querySelectorAll(".modal-close").forEach(e=>{e.addEventListener("click",function(){this.closest(".modal")?.classList.remove("active")})});
'@

$content | Out-File -FilePath "js/admin.js" -Encoding UTF8 -NoNewline
Write-Host "Archivo admin.js creado exitosamente"
